# Tekton / OpenShift Pipelines Process using PERL for further result analysis

## Overview

This sample includes Tasks for:

|Task|Description|
|---|---|
|`acs-deployment-check`|Scan a series of yaml or yml files and generate a results file for each|
|`acs-process-scan-results`|Use a PERL script to analyse the results of the scans and generate summary results including total number of policy violations and alphabetic list of the unique policy violations. The task will set an output result variable that can be used by a 'when' clause of a subsequent task to decide whether or not to continue with the execution of the pipeline.|
|`deploy`|Sample deployment Task that is used to illustrate the use of the 'when' clause in the example pipeline.|

To use the pipeline assets in this directory create a secret to hold the API token and the Advanced Cluster Security central endpoint using the command (executed within the context of the OpenShift project):

oc create secret generic acs-secret --from-literal=acs_api_token=<ci token generated by the ACS user interface> --from-literal=acs_central_endpoint=<central URL>:443

## Installation & Testing

Use `kubectl apply -f Tasks/` or `oc apply -f Tasks/` to create the ClusterTasks for use in the cluster.

To use the demonstration pipeline create it using the command `kubectl apply -f Pipeline/acs-pipeline.yaml` or `oc apply -f Pipeline/acs-pipeline.yaml`.

To use the sample piplelineRun or to integrate elements of the pipeline into your specific pipeline ensure the following values are set :

git-url - Set to the https:// address of the git repository containing the yaml or yml files to be examined. Feel free to use https://github.com/marrober/contributions.git as a test repository of content.

git-revision - Set to the branch or commit of the git repository. For more details of what this can be set to take a look at the git-clone cluster task. 

file-location-in-git-repo - The directory within the git repository containing the files to be examined. The git repository above contains sample files in the directory ci/Tekton/Scenario2/assets-for-validation.

perl-script-location - The location of the perl script to be used to perform the processing of the results files and to generate the overall result for the resource scan. Place this in the same repository as your resources to be scanned or clone it from a standard location to a workspace as part of the pipeline process. The git repository above contains a sample script in the directory /files/ci/Tekton/Scenario2/perl-script/.

recursive-search - recursive search of the file-location-in-git-repo path for resources to scan (true or false)

include-rox-output - Include the standard output from the roxctl scan command in addition to the summary produced by the PERL script (true or false)
